# Can't restore the flag? (207pt Hard)
# 問題文
ちりつもですよ

# やったこと

zipファイルを展開するとサーバ側で動いているスクリプトが出てきました．

```py
from Crypto.Util.number import bytes_to_long

with open("flag.txt", "rb") as f:
    flag = f.read()
flag = bytes_to_long(flag)

assert flag <= 10 ** 103

upper_bound = 300
while True:
    try:
        mod = int(input("Mod > "))
        if mod > upper_bound:
            print("Don't cheat 🤪")
            continue

        result = flag % mod
        print(result)
    except Exception:
        print("Bye 👋")
        break
```

フラグを数値に変換したものを，
ユーザからの入力値で割った余りを出力するようです．
ユーザから入力できる値の上限は300です．

出力結果である余りの値を集めてフラグの数値を推測する問題かなと思いましたが，
数学よわよわ勢なので解けませんでした．悲しみ．

時間を置いてから再挑戦しようと問題スクリプトを見直したところ，
ユーザの入力の下限値が設定されていないことに気がつきました．

試しに負の値を入力すると，対応する結果が帰ってきました．
```
nc crt.cry.wanictf.org 50000
Mod > -1
0
Mod > -2
0
Mod > -3
-1
```

負の数での剰余について少し調査
```py
>>> 123 % -1000000
-999877
>>> 1000000 - 999877
123
```
たしかに大きな負の数で剰余した結果から元の値を復元できえることが確かめられました
これを使ってフラグの値をとってみます．

```
nc crt.cry.wanictf.org 50000
Mod > -1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-999999999999999999990159419553623771292182053863936378683792187168026886550747783166620982570144103000771436923911878705910
```

```
python 
>>> 1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 - 999999999999999999990159419553623771292182053863936378683792187168026886550747783166620982570144103000771436923911878705910
9840580446376228707817946136063621316207812831973113449252216833379017429855896999228563076088121294090
```

これでフラグ全体の数値が手に入りました．
この数値を文字列に変換してみます．

```python
a = 9840580446376228707817946136063621316207812831973113449252216833379017429855896999228563076088121294090
print(a)
h = hex(a)[2:]
print(h)

flag = ''
for i in range(0, len(h), 2):
    flag += chr(int(h[i:i+2], 16))

print(flag)
```

```
$ python solver.py 
9840580446376228707817946136063621316207812831973113449252216833379017429855896999228563076088121294090
464c41477b4368316e3373335f72336d40316e6433725f3768333072336d5f5f736f5f75356566756c7d0a
FLAG{Ch1n3s3_r3m@1nd3r_7h30r3m__so_u5eful}
```
フラグが得られました．

# フラグ
FLAG{Ch1n3s3_r3m@1nd3r_7h30r3m__so_u5eful}
